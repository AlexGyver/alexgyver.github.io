(()=>{var t={947:(t,e,n)=>{"use strict";t.exports=function(t){const e=n(94),i=t?t.preset:"ru",r={а:"a",б:"b",в:"v",д:"d",з:"z",й:"y",к:"k",л:"l",м:"m",н:"n",о:"o",п:"p",р:"r",с:"s",т:"t",у:"u",ф:"f",ь:""};let s;"ru"===i?Object.assign(r,{г:"g",и:"i",ъ:"",ы:"i",э:"e"}):"uk"===i?Object.assign(r,{г:"h",ґ:"g",е:"e",и:"y",і:"i","'":"","’":"",ʼ:""}):"mn"===i&&Object.assign(r,{г:"g",ө:"o",ү:"u",и:"i",ы:"y",э:"e",ъ:""}),"ru"===i?s=Object.assign(e(r),{i:"и","":""}):("uk"===i||"mn"===i)&&(s=Object.assign(e(r),{"":""}));const a="ru"===i?{е:"ye"}:{є:"ye",ї:"yi"},o={ё:"yo",ж:"zh",х:"kh",ц:"ts",ч:"ch",ш:"sh",щ:"shch",ю:"yu",я:"ya"},l=Object.assign({},o,a),c=Object.assign(e(l)),h=Object.assign(r,l),u=Object.assign({},r,{й:"i"});let d;"ru"===i?Object.assign(u,{е:"e"}):"uk"===i?Object.assign(u,{ї:"i"}):"mn"===i&&Object.assign(u,{е:"e"}),"ru"===i?d=Object.assign(e(r),{i:"и",y:"ы",e:"е","":""}):"uk"===i&&(d=Object.assign(e(r),{"":""}));let f={};"uk"===i&&(f={є:"ie",ю:"iu",я:"ia"});const g=Object.assign(o,f),_=Object.assign(e(g)),v=Object.assign(u,g);return{transform:function(t,e){if(!t)return"";const n=t.normalize();let r="",s=!1;for(let t=0;t<n.length;t++){const a=n[t]===n[t].toUpperCase();let o,l=n[t].toLowerCase();" "!==l?("uk"===i&&"зг"===n.slice(t-1,t+1).toLowerCase()?o="gh":0===t||s?(o=h[l],s=!1):o=v[l],void 0===o?r+=a?l.toUpperCase():l:a?o.length>1?r+=o[0].toUpperCase()+o.slice(1):r+=o.toUpperCase():r+=o):(r+=e||" ",s=!0)}return r},reverse:function(t,e){if(!t)return"";const n=t.normalize();let i="",r=!1,a=0;for(;a<n.length;){const t=n[a]===n[a].toUpperCase();let o,l=n[a].toLowerCase(),h=a;if(" "===l||l===e){i+=" ",r=!0,a++;continue}let u=n.slice(a,a+2).toLowerCase();0===a||r?(o=c[u],o?a+=2:(o=s[l],a++),r=!1):(o=_[u],o?a+=2:(o=d[l],a++)),"shch"===n.slice(h,h+4).toLowerCase()?(o="щ",a=h+4):"zgh"===n.slice(h-1,h+2).toLowerCase()&&(o="г",a=h+2),void 0===o?i+=t?l.toUpperCase():l:t?o.length>1?i+=o[0].toUpperCase()+o.slice(1):i+=o.toUpperCase():i+=o}return i}}}},94:t=>{var e=9007199254740991,n="[object Arguments]",i="[object Function]",r="[object GeneratorFunction]",s=/^(?:0|[1-9]\d*)$/;var a,o,l=Object.prototype,c=l.hasOwnProperty,h=l.toString,u=l.propertyIsEnumerable,d=(a=Object.keys,o=Object,function(t){return a(o(t))});function f(t,e){var i=p(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&x(t)}(t)&&c.call(t,"callee")&&(!u.call(t,"callee")||h.call(t)==n)}(t)?function(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}(t.length,String):[],r=i.length,s=!!r;for(var a in t)!e&&!c.call(t,a)||s&&("length"==a||m(a,r))||i.push(a);return i}var g,_=function(t,e,n){for(var i=-1,r=Object(t),s=n(t),a=s.length;a--;){var o=s[g?a:++i];if(!1===e(r[o],o,r))break}return t};function v(t,e,n,i){return function(t,e){t&&_(t,e,H)}(t,(function(t,r,s){e(i,n(t),r,s)})),i}function b(t){if(n=(e=t)&&e.constructor,i="function"==typeof n&&n.prototype||l,e!==i)return d(t);var e,n,i,r=[];for(var s in Object(t))c.call(t,s)&&"constructor"!=s&&r.push(s);return r}function m(t,n){return!!(n=null==n?e:n)&&("number"==typeof t||s.test(t))&&t>-1&&t%1==0&&t<n}var p=Array.isArray;function x(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=e}(t.length)&&!function(t){var e=function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}(t)?h.call(t):"";return e==i||e==r}(t)}var y,w,C,k=(y=function(t,e,n){t[e]=n},C=function(t){return t},w=function(){return C},function(t,e){return v(t,y,w(e),{})});function H(t){return x(t)?f(t):b(t)}t.exports=k},485:t=>{!function(){var e=0;function n(){return"qs_"+ ++e}function i(t,e){var n=s("div",null,"qs_label",e);return n.innerHTML=t,n}function r(t,e,n,i){var r=s("input",e,n,i);return r.type=t,r}function s(t,e,n,i){var r=document.createElement(t);if(r)return r.id=e,n&&(r.className=n),i&&i.appendChild(r),r}function a(){return-1!=navigator.userAgent.indexOf("rv:11")||-1!=navigator.userAgent.indexOf("MSIE")}var o={_version:"3.0.2",_topZ:1,_panel:null,_titleBar:null,_content:null,_startX:0,_startY:0,_hidden:!1,_collapsed:!1,_controls:null,_keyCodeArray:new Array,_draggable:!0,_collapsible:!0,_globalChangeHandler:null,useExtStyleSheet:function(){!0},create:function(t,e,n,i){var r=Object.create(this);return r._init(t,e,n,i),r},destroy:function(){for(var t in this._panel.parentElement&&this._panel.parentElement.removeChild(this._panel),this)this[t]=null},_init:function(t,e,n,i){this._bindHandlers(),this._createPanel(t,e,i),this._createTitleBar(n||"QuickSettings"),this._createContent()},_bindHandlers:function(){this._startDrag=this._startDrag.bind(this),this._drag=this._drag.bind(this),this._endDrag=this._endDrag.bind(this),this._doubleClickTitle=this._doubleClickTitle.bind(this),this._onKeyUp=this._onKeyUp.bind(this)},getValuesAsJSON:function(t){var e={};for(var n in this._controls)this._controls[n].getValue&&(e[n]=this._controls[n].getValue());return t&&(e=JSON.stringify(e)),e},setValuesFromJSON:function(t){for(var e in"string"==typeof t&&(t=JSON.parse(t)),t)this._controls[e]&&this._controls[e].setValue&&this._controls[e].setValue(t[e]);return this},saveInLocalStorage:function(t){return this._localStorageName=t,this._readFromLocalStorage(t),this},clearLocalStorage:function(t){return localStorage.removeItem(t),this},_saveInLocalStorage:function(t){localStorage.setItem(t,this.getValuesAsJSON(!0))},_readFromLocalStorage:function(t){var e=localStorage.getItem(t);e&&this.setValuesFromJSON(e)},_createPanel:function(t,e,n){this._panel=s("div",null,"qs_main",n||document.body),this._panel.style.zIndex=++o._topZ,this.setPosition(t||0,e||0),this._controls={}},_createTitleBar:function(t){this._titleBar=s("div",null,"qs_title_bar",this._panel),this._titleBar.textContent=t,this._titleBar.addEventListener("mousedown",this._startDrag),this._titleBar.addEventListener("dblclick",this._doubleClickTitle)},_createContent:function(){this._content=s("div",null,"qs_content",this._panel)},_createContainer:function(){var t=s("div",null,"qs_container");return t.addEventListener("focus",(function(){this.className+=" qs_container_selected"}),!0),t.addEventListener("blur",(function(){var t=this.className.indexOf(" qs_container_selected");t>-1&&(this.className=this.className.substr(0,t))}),!0),this._content.appendChild(t),t},setPosition:function(t,e){return this._panel.style.left=t+"px",this._panel.style.top=Math.max(e,0)+"px",this},setSize:function(t,e){return this._panel.style.width=t+"px",this._content.style.width=t+"px",this._content.style.height=e-this._titleBar.offsetHeight+"px",this},setWidth:function(t){return this._panel.style.width=t+"px",this._content.style.width=t+"px",this},setHeight:function(t){return this._content.style.height=t-this._titleBar.offsetHeight+"px",this},setDraggable:function(t){return this._draggable=t,this._draggable||this._collapsible?this._titleBar.style.cursor="pointer":this._titleBar.style.cursor="default",this},_startDrag:function(t){this._draggable&&(this._panel.style.zIndex=++o._topZ,document.addEventListener("mousemove",this._drag),document.addEventListener("mouseup",this._endDrag),this._startX=t.clientX,this._startY=t.clientY),t.preventDefault()},_drag:function(t){var e=parseInt(this._panel.style.left),n=parseInt(this._panel.style.top),i=t.clientX,r=t.clientY;this.setPosition(e+i-this._startX,n+r-this._startY),this._startX=i,this._startY=r,t.preventDefault()},_endDrag:function(t){document.removeEventListener("mousemove",this._drag),document.removeEventListener("mouseup",this._endDrag),t.preventDefault()},setGlobalChangeHandler:function(t){return this._globalChangeHandler=t,this},_callGCH:function(t){this._localStorageName&&this._saveInLocalStorage(this._localStorageName),this._globalChangeHandler&&this._globalChangeHandler(t)},hide:function(){return this._panel.style.visibility="hidden",this._hidden=!0,this},show:function(){return this._panel.style.visibility="visible",this._panel.style.zIndex=++o._topZ,this._hidden=!1,this},toggleVisibility:function(){return this._hidden?this.show():this.hide(),this},setCollapsible:function(t){return this._collapsible=t,this._draggable||this._collapsible?this._titleBar.style.cursor="pointer":this._titleBar.style.cursor="default",this},collapse:function(){return this._panel.removeChild(this._content),this._collapsed=!0,this},expand:function(){return this._panel.appendChild(this._content),this._collapsed=!1,this},toggleCollapsed:function(){return this._collapsed?this.expand():this.collapse(),this},setKey:function(t){return Number.isInteger(t)?this._keyCodeArray.push(t):this._keyCodeArray.push(t.toUpperCase().charCodeAt(0)),document.addEventListener("keyup",this._onKeyUp),this},_onKeyUp:function(t){this._keyCodeArray.includes(t.keyCode)&&this.toggleVisibility()},_doubleClickTitle:function(){this._collapsible&&this.toggleCollapsed()},removeControl:function(t){if(this._controls[t])var e=this._controls[t].container;return e&&e.parentElement&&e.parentElement.removeChild(e),this._controls[t]=null,this},enableControl:function(t){return this._controls[t]&&(this._controls[t].control.disabled=!1),this},disableControl:function(t){return this._controls[t]&&(this._controls[t].control.disabled=!0),this},hideControl:function(t){return this._controls[t]&&(this._controls[t].container.style.display="none"),this},showControl:function(t){return this._controls[t]&&(this._controls[t].container.style.display="block"),this},overrideStyle:function(t,e,n){return this._controls[t]&&(this._controls[t].control.style[e]=n),this},hideTitle:function(t){var e=this._controls[t].label;return e&&(e.style.display="none"),this},showTitle:function(t){var e=this._controls[t].label;return e&&(e.style.display="block"),this},hideAllTitles:function(){for(var t in this._controls){var e=this._controls[t].label;e&&(e.style.display="none")}return this},showAllTitles:function(){for(var t in this._controls){var e=this._controls[t].label;e&&(e.style.display="block")}return this},getValue:function(t){return this._controls[t].getValue()},setValue:function(t,e){return this._controls[t].setValue(e),this._callGCH(t),this},addBoolean:function(t,e,i){var a=this._createContainer(),o=n(),l=s("label",null,"qs_checkbox_label",a);l.textContent=t,l.setAttribute("for",o);var c=s("label",null,"qs_checkbox",a);c.setAttribute("for",o);var h=r("checkbox",o,null,c);h.checked=e;s("span",null,null,c);this._controls[t]={container:a,control:h,getValue:function(){return this.control.checked},setValue:function(t){this.control.checked=t,i&&i(t)}};var u=this;return h.addEventListener("change",(function(){i&&i(h.checked),u._callGCH(t)})),this},bindBoolean:function(t,e,n){return this.addBoolean(t,e,(function(e){n[t]=e}))},addButton:function(t,e){var i=this._createContainer(),s=r("button",n(),"qs_button",i);s.value=t,this._controls[t]={container:i,control:s};var a=this;return s.addEventListener("click",(function(){e&&e(s),a._callGCH(t)})),this},addButtons:function(t){var e=this._createContainer();for(let a in t){var i=r("button",n(),"qs_button",e);i.value=a,this._controls[a]={container:e,control:i};var s=this;i.addEventListener("click",(function(){t[a]&&t[a](i),s._callGCH(a)}))}return this},addColor:function(t,e,o){if(!((l=navigator.userAgent.toLowerCase()).indexOf("chrome")>-1||l.indexOf("firefox")>-1||l.indexOf("epiphany")>-1)&&l.indexOf("safari/")>-1||navigator.userAgent.toLowerCase().indexOf("edge")>-1||a())return this.addText(t,e,o);var l,c=this._createContainer(),h=i("<b>"+t+":</b> "+e,c),u=n(),d=r("color",u,"qs_color",c);d.value=e||"#ff0000";var f=s("label",null,"qs_color_label",c);f.setAttribute("for",u),f.style.backgroundColor=d.value,this._controls[t]={container:c,control:d,colorLabel:f,label:h,title:t,getValue:function(){return this.control.value},setValue:function(t){this.control.value=t,this.colorLabel.style.backgroundColor=d.value,this.label.innerHTML="<b>"+this.title+":</b> "+this.control.value,o&&o(t)}};var g=this;return d.addEventListener("input",(function(){h.innerHTML="<b>"+t+":</b> "+d.value,f.style.backgroundColor=d.value,o&&o(d.value),g._callGCH(t)})),this},bindColor:function(t,e,n){return this.addColor(t,e,(function(e){n[t]=e}))},addDate:function(t,e,s){function o(t){if(t instanceof Date){var e=t.getFullYear(),n=t.getMonth()+1;n<10&&(n="0"+n);var i=t.getDate();return i<10&&(i="0"+i),e+"-"+n+"-"+i}return t}var l=o(e);if(a())return this.addText(t,l,s);var c=this._createContainer(),h=i("<b>"+t+"</b>",c),u=r("date",n(),"qs_text_input",c);u.value=l||"",this._controls[t]={container:c,control:u,label:h,getValue:function(){return this.control.value},setValue:function(t){var e=o(t);this.control.value=e||"",s&&s(e)}};var d=this;return u.addEventListener("input",(function(){s&&s(u.value),d._callGCH(t)})),this},bindDate:function(t,e,n){return this.addDate(t,e,(function(e){n[t]=e}))},addDropDown:function(t,e,n){for(var r=this._createContainer(),a=i("<b>"+t+"</b>",r),o=s("select",null,"qs_select",r),l=0;l<e.length;l++){var c=s("option"),h=e[l];h.label?(c.value=h.value,c.innerText=h.label):(c.label=h,c.innerText=h),o.add(c)}var u=this;return o.addEventListener("change",(function(){var i=o.selectedIndex,r=o.options;n&&n({index:i,label:r[i].label,value:e[i].value||e[i]}),u._callGCH(t)})),this._controls[t]={container:r,control:o,label:a,getValue:function(){var t=this.control.selectedIndex;return{index:t,label:this.control.options[t].label,value:e[t].value||e[t]}},setValue:function(t){var i;i=null!=t.index?t.index:t;var r=this.control.options;this.control.selectedIndex=i,n&&n({index:i,label:r[i].label,value:e[i].value||e[i]})}},this},bindDropDown:function(t,e,n){return this.addDropDown(t,e,(function(e){n[t]=e.value}))},addElement:function(t,e){var n=this._createContainer(),r=i("<b>"+t+"</b>",n);return n.appendChild(e),this._controls[t]={container:n,label:r},this},addFileChooser:function(t,e,a,o){var l=this._createContainer(),c=i("<b>"+t+"</b>",l),h=n(),u=r("file",h,"qs_file_chooser",l);a&&(u.accept=a);var d=s("label",null,"qs_file_chooser_label",l);d.setAttribute("for",h),d.textContent=e||"Choose a file...",this._controls[t]={container:l,control:u,label:c,getValue:function(){return this.control.files[0]}};var f=this;return u.addEventListener("change",(function(){u.files&&u.files.length&&(d.textContent=u.files[0].name,o&&o(u.files[0]),f._callGCH(t))})),this},addHTML:function(t,e){var n=this._createContainer(),r=t?i("<b>"+t+":</b> ",n):null,a=s("div",null,null,n);return a.innerHTML=e,this._controls[t]={container:n,label:r,control:a,getValue:function(){return this.control.innerHTML},setValue:function(t){this.control.innerHTML=t}},this},addImage:function(t,e,n){var r=this._createContainer(),a=i("<b>"+t+"</b>",r);return img=s("img",null,"qs_image",r),img.src=e,this._controls[t]={container:r,control:img,label:a,getValue:function(){return this.control.src},setValue:function(t){this.control.src=t,n&&img.addEventListener("load",(function e(){img.removeEventListener("load",e),n(t)}))}},this},addRange:function(t,e,n,i,r,s){return this._addNumber("range",t,e,n,i,r,s)},addNumber:function(t,e,n,i,r,s){return this._addNumber("number",t,e,n,i,r,s)},_addNumber:function(t,e,s,o,l,c,h){var u=this._createContainer(),d=i("",u),f="range"===t?"qs_range":"qs_text_input qs_number",g=r(t,n(),f,u);g.min=s||0,g.max=o||100,g.step=c||1,g.value=l||0,d.innerHTML="<b>"+e+":</b> "+g.value,this._controls[e]={container:u,control:g,label:d,title:e,callback:h,getValue:function(){return parseFloat(this.control.value)},setValue:function(t){this.control.value=t,this.label.innerHTML="<b>"+this.title+":</b> "+this.control.value,h&&h(parseFloat(t))}};var _="input";"range"===t&&a()&&(_="change");var v=this;return g.addEventListener(_,(function(){d.innerHTML="<b>"+e+":</b> "+g.value,h&&h(parseFloat(g.value)),v._callGCH(e)})),this},bindRange:function(t,e,n,i,r,s){return this.addRange(t,e,n,i,r,(function(e){s[t]=e}))},bindNumber:function(t,e,n,i,r,s){return this.addNumber(t,e,n,i,r,(function(e){s[t]=e}))},setRangeParameters:function(t,e,n,i){return this.setNumberParameters(t,e,n,i)},setNumberParameters:function(t,e,n,i){var r=this._controls[t],s=r.control.value;return r.control.min=e,r.control.max=n,r.control.step=i,r.control.value!==s&&r.callback&&r.callback(r.control.value),this},addPassword:function(t,e,n){return this._addText("password",t,e,n)},bindPassword:function(t,e,n){return this.addPassword(t,e,(function(e){n[t]=e}))},addProgressBar:function(t,e,n,r){var a=this._createContainer(),o=i("",a),l=s("div",null,"qs_progress",a),c=s("div",null,"qs_progress_value",l);return c.style.width=n/e*100+"%",o.innerHTML="numbers"===r?"<b>"+t+":</b> "+n+" / "+e:"percent"===r?"<b>"+t+":</b> "+Math.round(n/e*100)+"%":"<b>"+t+"</b>",this._controls[t]={container:a,control:l,valueDiv:c,valueDisplay:r,label:o,value:n,max:e,title:t,getValue:function(){return this.value},setValue:function(t){this.value=Math.max(0,Math.min(t,this.max)),this.valueDiv.style.width=this.value/this.max*100+"%","numbers"===this.valueDisplay?this.label.innerHTML="<b>"+this.title+":</b> "+this.value+" / "+this.max:"percent"===this.valueDisplay&&(this.label.innerHTML="<b>"+this.title+":</b> "+Math.round(this.value/this.max*100)+"%")}},this},setProgressMax:function(t,e){var n=this._controls[t];return n.max=e,n.value=Math.min(n.value,n.max),n.valueDiv.style.width=n.value/n.max*100+"%","numbers"===n.valueDisplay?n.label.innerHTML="<b>"+n.title+":</b> "+n.value+" / "+n.max:"percent"===n.valueDisplay?n.label.innerHTML="<b>"+n.title+":</b> "+Math.round(n.value/n.max*100)+"%":n.label.innerHTML="<b>"+n.title+"</b>",this},addText:function(t,e,n){return this._addText("text",t,e,n)},_addText:function(t,e,a,o){var l,c=this._createContainer(),h=i("<b>"+e+"</b>",c);"textarea"===t?(l=s("textarea",n(),"qs_textarea",c)).rows=5:l=r(t,n(),"qs_text_input",c),l.value=a||"",this._controls[e]={container:c,control:l,label:h,getValue:function(){return this.control.value},setValue:function(t){this.control.value=t,o&&o(t)}};var u=this;return l.addEventListener("input",(function(){o&&o(l.value),u._callGCH(e)})),this},bindText:function(t,e,n){return this.addText(t,e,(function(e){n[t]=e}))},addTextArea:function(t,e,n){return this._addText("textarea",t,e,n)},setTextAreaRows:function(t,e){return this._controls[t].control.rows=e,this},bindTextArea:function(t,e,n){return this.addTextArea(t,e,(function(e){n[t]=e}))},addTime:function(t,e,s){var o;if(e instanceof Date){var l=e.getHours();l<10&&(l="0"+l);var c=e.getMinutes();c<10&&(c="0"+c);var h=e.getSeconds();h<10&&(h="0"+h),o=l+":"+c+":"+h}else o=e;if(a())return this.addText(t,o,s);var u=this._createContainer(),d=i("<b>"+t+"</b>",u),f=r("time",n(),"qs_text_input",u);f.value=o||"",this._controls[t]={container:u,control:f,label:d,getValue:function(){return this.control.value},setValue:function(t){var e;if(t instanceof Date){var n=t.getHours();n<10&&(n="0"+n);var i=t.getMinutes();i<10&&(i="0"+i);var r=t.getSeconds();r<10&&(r="0"+r),e=n+":"+i+":"+r}else e=t;this.control.value=e||"",s&&s(e)}};var g=this;return f.addEventListener("input",(function(){s&&s(f.value),g._callGCH(t)})),this},bindTime:function(t,e,n){return this.addTime(t,e,(function(e){n[t]=e}))}};t.exports=o}()}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var s=e[i]={exports:{}};return t[i](s,s.exports,n),s.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=n(485),e=n.n(t);class i{matrix=[];W=0;H=0;constructor(t,e){this.resize(t,e)}resize(t,e){t&&e&&(this.W=t,this.H=e,this.matrix=new Array(t*e).fill(0))}merge(t){if(this.matrix.length==t.matrix.length)for(let e=0;e<this.matrix.length;e++){let n=t.matrix[e];n&&(this.matrix[e]=1==n?1:0)}}clone(){let t=new i;return t.W=this.W,t.H=this.H,t.matrix=[...this.matrix],t}set(t,e,n){t>=0&&t<this.W&&e>=0&&e<this.H&&(this.matrix[e*this.W+t]=n)}get(t,e){return t>=0&&t<this.W&&e>=0&&e<this.H?this.matrix[e*this.W+t]:0}clear(){this.matrix&&this.matrix.fill(0)}}class r extends i{constructor(t,e,n,i,r="#478be6",s="black"){super(),t&&(this.cv=t,this.cx=t.getContext("2d"),this.setColors(r,s),this._onclick=e,this._ondrag=n,this._onwheel=i,window.addEventListener("resize",(()=>this._resize())),t.addEventListener("mousedown",(t=>this._onMouseDown(t))),t.addEventListener("mousewheel",(t=>this._onMouseWheel(t))),t.addEventListener("contextmenu",(t=>t.preventDefault())),document.addEventListener("mousemove",(t=>this._onMouseMove(t))),document.addEventListener("mouseup",(t=>this._onMouseUp(t))))}setColors(t,e){this.on=t,this.off=e,this.cx.strokeStyle=e}resize(t,e){super.resize(t,e),this._resize()}render(){this.cx.fillStyle=this.off,this.cx.fillRect(0,0,this.cv.width,this.cv.height);let t=this._blocksize;this.cx.fillStyle=this.on;for(let e=0;e<this.W;e++)for(let n=0;n<this.H;n++)this.get(e,n)&&(this.cx.fillRect(e*t,n*t,t,t),t>3&&this.cx.strokeRect(e*t,n*t,t,t));this.cx.fillStyle=this.off}grid(){let t=this._blocksize;for(let e=0;e<this.W;e++)this.cx.beginPath(),this.cx.moveTo(e*t,0),this.cx.lineTo(e*t,this.cv.height),this.cx.stroke();for(let e=0;e<this.H;e++)this.cx.beginPath(),this.cx.moveTo(0,e*t),this.cx.lineTo(this.cv.width,e*t),this.cx.stroke()}_blocksize=0;_scale=1;_pressed=!1;_dragged=!1;_pressXY=[];realW=0;realh=0;_resize(){if(!this.cv)return;let t=this.cv.parentNode.clientWidth;t=Math.floor(t/this.W)*this.W,t||(t=this.W);let e=t*this.H/this.W;this._blocksize=t/this.W,this.cv.width=t,this.cv.height=e,this.cx.lineWidth=this._blocksize/64,t=this.cv.parentNode.clientWidth,e=t*this.H/this.W,e>800&&(e=800,t=e*this.W/this.H),this.realW=t,this.realH=e,this.cv.style.width=t+"px",this.cv.style.height=e+"px",this.render()}_onMouseWheel(t){this._onwheel(t.deltaY<0?1:-1)}_onMouseDown(t){this._pressed=!0,this._dragged=!1,this._pressXY=this._getXY(t)}_onMouseMove(t){if(!this._pressed)return;this._dragged||(this.cv.style.cursor="grab",document.body.style.cursor="grab"),this._dragged=!0;let e=this._getXY(t);this._ondrag(this._drag(e,!1),{1:0,4:1,2:2}[t.buttons])}_onMouseUp(t){if(!this._pressed)return;this._pressed=!1;let e=this._getXY(t);this._dragged?(this.cv.style.cursor="pointer",document.body.style.cursor="default",this._ondrag(this._drag(e,!0),t.button)):this._onclick(this._blockXY(e),t.button),this._dragged=!1}_getXY(t){let e=t.pageX,n=t.pageY;return"BODY"===this.cv.offsetParent.tagName.toUpperCase()?(e-=this.cv.offsetLeft,n-=this.cv.offsetTop):(e-=this.cv.offsetParent.offsetLeft,n-=this.cv.offsetParent.offsetTop),e*=this.cv.width/this.realW,n*=this.cv.height/this.realH,{x:e,y:n}}_blockXY(t){return{x:Math.floor(t.x/this.cv.width*this.W),y:Math.floor(t.y/this.cv.height*this.H)}}_drag(t,e){return{dx:t.x-this._pressXY.x,dy:t.y-this._pressXY.y,block:this._blockXY(t),release:e}}}var s=n(947),a=n.n(s);function o(t){let e=[255&t.H,t.H>>8&255,0,0],n=0,i=0,r=0,s=()=>{let t=n<<1|i;switch(3&r++){case 0:e.push(t<<2);break;case 1:e[e.length-1]|=t>>4,e.push(t<<4&240);break;case 2:e[e.length-1]|=t>>2,e.push(t<<6&192);break;case 3:e[e.length-1]|=t}};for(let e=0;e<t.W;e++)for(let r=0;r<t.H;r++){let a=t.get(e,r);n?i==a?(n++,31==n&&(s(),n=0)):(s(),i=a,n=1):(n=1,i=a)}n&&s();let a=e.length-4;return e[2]=255&a,e[3]=a>>8&255,e}function l(t){return[255&t.W,t.W>>8&255,255&t.H,t.H>>8&255].concat(function(t){let e=[],n=Math.ceil(t.H/8);for(let i=0;i<n;i++)for(let n=0;n<t.W;n++){let r=0;for(let e=0;e<8;e++)r>>=1,r|=t.get(n,8*i+e)<<7;e.push(r)}return e}(t))}function c(t,e){switch(e){case 0:return function(t){return[...t.matrix]}(t);case 1:return function(t){let e=[],n=Math.ceil(t.W/8);for(let i=0;i<t.H;i++)for(let r=0;r<n;r++){let n=0;for(let e=0;e<8;e++)n<<=1,n|=t.get(8*r+e,i);e.push(n)}return e}(t);case 2:return function(t){let e=[],n=Math.ceil(t.H/8);for(let i=0;i<t.W;i++)for(let r=0;r<n;r++){let n=0;for(let e=0;e<8;e++)n>>=1,n|=t.get(i,8*r+e)<<7;e.push(n)}return e}(t);case 3:{let e=Math.ceil(t.H/8)*t.W+4,n=o(t);return e<=n.length?[0].concat(l(t)):[1].concat(n)}case 4:return l(t);case 5:return o(t)}}const h=["1x pix/byte","8x Horizontal","8x Vertical","GyverGFX Image","GyverGFX BitMap","GyverGFX BitPack"];function u(t,e){let n=c(t,e),i=Int8Array.from(n);return new Blob([i],{type:"application/octet-stream"})}function d(t,e,n){let i="";switch(e){case 0:case 1:case 2:i+=`const uint8_t ${n}_${t.W}x${t.H}[] PROGMEM = {`;break;case 3:i+=`gfximage_t ${n}_${t.W}x${t.H}[] PROGMEM = {`;break;case 4:i+=`gfxmap_t ${n}_${t.W}x${t.H}[] PROGMEM = {`;break;case 5:i+=`gfxpack_t ${n}_${t.W}x${t.H}[] PROGMEM = {`}let r=c(t,e);return i+=function(t,e=16){let n="",i=0;for(let r of t)i||(n+="\n\t"),n+=`0x${r.toString(16).padStart(2,0)}, `,++i==e&&(i=0);return n}(r,24),i+="\n};",{code:i,size:r.length}}let f,g;let _=new r,v=new class{name="";image;first=!1;offset={x:0,y:0,dx:0,dy:0,w:0};async load(t){return new Promise(((e,n)=>{const i=new Image;switch(i.crossOrigin="Anonymous",i.addEventListener("load",(()=>{i.width&&i.height?(this.image=i,this.first=!0,e()):n("Image error")})),i.addEventListener("error",(()=>{n("Image load error")})),typeof t){case"object":t.type.toString().includes("image")||n("Not an image"),i.src=URL.createObjectURL(t),this.name=this._getName(t.name);break;case"string":t.startsWith("http")||n("Not a link"),i.src=t,this.name=this._getName(t);break;default:n("Image error")}}))}scale(t){this.image&&(this.offset.w+=t*this.offset.w/64)}pan(t,e,n){this.image&&(this.offset.dx=t,this.offset.dy=e,n&&(this.offset.x-=this.offset.dx,this.offset.dx=0,this.offset.y-=this.offset.dy,this.offset.dy=0))}show(t,e=0){this.image&&(this._render(t.cv,e),t.grid())}fit(t){this.offset={x:0,y:0,dx:0,dy:0,w:0};let e=t.cv.width,n=e*this.image.height/this.image.width;n>t.cv.height&&(e*=t.cv.height/n,n=t.cv.height),this.offset.w=e/t.cv.width}render(t,e=0,n=!1){if(!this.image)return;this.first&&(this.first=!1,this.fit(t));let i=document.createElement("canvas");i.width=t.cv.width,i.height=t.cv.height;let r=i.getContext("2d");r.fillStyle=n?"white":"black",r.fillRect(0,0,i.width,i.height),this._render(i,e);let s=document.createElement("canvas");s.width=t.W,s.height=t.H;let a=s.getContext("2d");a.drawImage(i,0,0,s.width,s.height),t.clear();let o=a.getImageData(0,0,t.W,t.H).data;for(let e=0,i=0;e<o.length;e+=4,i++)if(o[e+3]){let r=Math.round((o[e]+o[e+1]+o[e+2])/3);t.matrix[i]=n?255-r:r}}_render(t,e){let n=document.createElement("canvas"),i=t.width*this.offset.w,r=i*this.image.height/this.image.width,s=Math.sqrt(i**2+r**2);n.width=s,n.height=s;let a=n.getContext("2d");a.save(),a.translate(s/2,s/2),a.rotate(.0174533*-e),a.drawImage(this.image,-i/2,-r/2,i,r),a.restore();let o=t.getContext("2d");o.fillRect(0,0,t.width,t.height),o.drawImage(n,this.offset.x-this.offset.dx+(s-t.width)/2,this.offset.y-this.offset.dy+(s-t.height)/2,t.width,t.height,0,0,t.width,t.height)}_getName(t){return(t=(t=(new(a())).transform(t,"_")).substring(t.lastIndexOf("/")+1,t.lastIndexOf(".")).replaceAll("-","_").substring(0,10)).length?t[0]>="0"&&t[0]<="9"&&(t="b"+t):t="bitmap",t}},b=new i,m=new class{#t;start(t,e){this.stop(),this.#t=setTimeout(t,e)}stop(){this.#t&&(clearTimeout(this.#t),this.#t=null)}};const p={labels:["OLED","Paper"],values:[{on:"#478be6",off:"black",inv:!1},{on:"black",off:"white",inv:!0}]};async function x(t){try{await v.load(t)}catch(t){return void alert(t)}b.clear(),f.setValue("Name",v.name),k()}async function y(t){t.length&&(await x(t),f.setValue("Image Link",""))}function w(){let t=[f.getValue("Width"),f.getValue("Height")];_.resize(t[0],t[1]),b.resize(t[0],t[1]),Math.max(t[0],t[1])>500&&g.setValue("Preview",!1),k()}function C(){v.image&&v.fit(_),k()}function k(){if(v.image){let n=p.values[g.getValue("Display Style").index].inv^g.getValue("Inverse");v.render(_,f.getValue("Rotate"),n);let i=g.getValue("Gamma"),r=g.getValue("Sobel Edges");1!=i&&(e=i,(t=_).matrix=t.matrix.map((t=>Math.min(255,Math.pow(t,e))))),function(t,e,n){t.matrix=t.matrix.map((t=>(t=t*n+e)<0?0:t>255?255:t))}(_,g.getValue("Brightness"),g.getValue("Contrast")),g.getValue("Blur")&&function(t){let e=t.clone(),n=[[1,2,1],[2,4,2],[1,2,1]];n=n.map((t=>t.map((t=>.0625*t))));for(let i=1;i<t.H-1;i++)for(let r=1;r<t.W-1;r++){let s=0;for(let t=-1;t<=1;t++)for(let a=-1;a<=1;a++)s+=n[t+1][a+1]*e.get(r+a,i+t);t.set(r,i,s)}}(_),g.getValue("Edges")&&function(t){const e=[[-1,-1,-1],[-1,9,-1],[-1,-1,-1]];let n=t.clone();for(let i=1;i<n.W-1;i++)for(let r=1;r<n.H-1;r++){let s=0;for(let t=-1;t<=1;t++)for(let a=-1;a<=1;a++){let o=n.get(i+t,r+a);s+=e[a+1][t+1]*o}s=s<0?0:s>255?255:s,t.set(i,r,s)}}(_),r&&function(t,e){const n=[[-1,0,1],[-2,0,2],[-1,0,1]],i=[[-1,-2,-1],[0,0,0],[1,2,1]];let r=t.clone();for(let e=0;e<t.W;e++)for(let s=0;s<t.H;s++){let a=0,o=0;if(0!=e&&e!=t.W-1&&0!=s&&s!=t.H-1)for(let r=-1;r<=1;r++)for(let l=-1;l<=1;l++){let c=t.get(e+r,s+l);a+=n[l+1][r+1]*c,o+=i[l+1][r+1]*c}let l=Math.sqrt(a**2+o**2);l=l<0?0:l>255?255:l,r.set(e,s,l)}for(let n=0;n<r.matrix.length;n++){let i=t.matrix[n]*(1-e)+r.matrix[n]*e;t.matrix[n]=i}}(_,r),g.getValue("Dither")&&function(t){for(let e=0;e<t.H;e++)for(let n=0;n<t.W;n++){let i=e*t.W+n,r=t.matrix[i]<128?0:255,s=t.matrix[i]-r;t.matrix[i]=r,n+1<t.W&&(t.matrix[i+1]+=7*s>>4),e+1!=t.H&&(n>0&&(t.matrix[i+t.W-1]+=3*s>>4),t.matrix[i+t.W]+=5*s>>4,n+1<t.W&&(t.matrix[i+t.W+1]+=1*s>>4))}}(_),function(t,e){t.matrix=t.matrix.map((t=>t<e?0:1))}(_,2.56*g.getValue("Threshold")),g.getValue("Median Edges")&&function(t){let e=[[0,0],[0,1],[1,0]],n=t.clone();for(let i=0;i<t.W;i++)for(let r=0;r<t.H;r++)if(0!=i&&i!=t.W-1&&0!=r&&r!=t.H-1){let s=[];for(let t=0;t<e.length;t++)s.push(n.get(i+e[t][0],r+e[t][1]));s.sort();let a=s[s.length-1]-s[0];t.set(i,r,a)}}(_)}var t,e;!function(){_.merge(b),_.render();let t=d(_,f.getValue("Process").index,f.getValue("Name"));f.setValue("Code",t.code);let e=`${_.W}x${_.H} (${t.size} bytes)<br>`;e+=Math.round(_.matrix.filter((t=>1==t)).length/_.matrix.length*100)+"% pixels on",f.setValue("Result",e)}()}function H(){let t=p.values[g.getValue("Display Style").index];_.setColors(t.on,t.off),k()}function L(){f.setValue("Rotate",0),g.setValue("Inverse",0),g.setValue("Brightness",0),g.setValue("Contrast",1),g.setValue("Threshold",50),g.setValue("Edges",0),g.setValue("Dither",0),b.clear()}function V(t){return 0==t?1:1==t?0:-1}function E(t,e){g.getValue("Editor")&&(b.set(t.x,t.y,V(e)),k())}function M(t,e){if(g.getValue("Editor"))return b.set(t.block.x,t.block.y,V(e)),void k();b.clear(),v.pan(t.dx,t.dy,t.release),g.getValue("Preview")||t.release?k():v.show(_,f.getValue("Rotate"))}function T(t){g.getValue("Editor")||(m.stop(),b.clear(),v.scale(t),g.getValue("Preview")?k():(v.show(_,f.getValue("Rotate")),m.start(k,400)))}function W(){b.clear(),g.getValue("Preview")?k():(v.show(_,f.getValue("Rotate")),m.start(k,400))}function B(){navigator.clipboard.writeText(f.getValue("Code"))}function D(){!function(t,e,n){let i=d(t,e,n),r=`#pragma once\n#include <Arduino.h>\n#include <GyverGFX.h>\n\n// ${n} (${i.size} bytes)\n// ${h[e]}\n\n`+i.code,s=(new TextEncoder).encode(r),a=new Blob([s],{type:"text/plain"}),o=document.createElement("a");o.href=window.URL.createObjectURL(a),o.download=n+".h",o.click()}(_,f.getValue("Process").index,f.getValue("Name"))}function S(){!function(t,e,n){let i=u(t,e),r=document.createElement("a");switch(r.href=window.URL.createObjectURL(i),e){case 0:case 1:case 2:n+=".bin";break;case 3:n+=".img";break;case 4:n+=".map";break;case 5:n+=".pack"}r.download=n,r.click()}(_,f.getValue("Process").index,f.getValue("Name"))}function O(){let t=u(_,f.getValue("Process").index),e=new FormData;e.append("bitmap",t),fetch(window.location.href+`bitmap?width=${_.W}&height=${_.H}`,{method:"POST",body:e})}function P(){let t=document.createElement("div"),e=document.createElement("div"),n=document.createElement("button"),i=document.createElement("span");t.className="info_cont",i.innerText="Bitmaper - программа для преобразования картинок в битмапы\n\nPROCESS\n- 1x pix/byte - 1 пиксель в байте, строками слева направо сверху вниз [data_0, ...data_n]\n- 8x Horizontal - 8 пикселей в байте горизонтально (MSB слева), строками слева направо сверху вниз [data_0, ...data_n]\n- 8x Vertical - 8 пикселей в байте вертикально (MSB снизу), столбцами сверху вниз слева направо  [data_0, ...data_n]\n- GyverGFX BitMap - 8 пикселей вертикально (MSB снизу), строками слева направо сверху вниз: [widthLSB, widthMSB, heightLSB, heightMSB, data_0, ...data_n]\n- GyverGFX BitPack - сжатый формат*: [heightLSB, heightMSB, lenLSB, lenMSB, data_0, ...data_n]\n- GyverGFX Image - программа выберет лёгкий между BitMap и BitPack: [0 map | 1 pack, x, x, x, x, data_0, ...data_n]\n* На изображениях со сплошными участками BitPack может быть в разы эффективнее обычного BitMap. На изображениях с dithering работает неэффективно.\n\nФИЛЬТРЫ\n- Inverse - инвертировать цвета\n- Gamma - логарифмическая яркость\n- Brightness - яркость\n- Contrast - контраст\n- Blur - размытие\n- Edges - усиление краёв\n- Sobel Edges - выделение краёв с настройкой интенсивности\n- Dither - псевдо оттенки серого через шум\n- Threshold - порог разделения оттенков серого на белый и чёрный. Не имеет смысла при включённом Dither\n- Median Edges - выделение краёв в толщину 1px. Работает на ч/б изображении, поэтому зависит от Threshold\n\nРЕДАКТОР (Editor)\n- Действия кнопок мыши при включенном редакторе: ЛКМ - добавить точку, ПКМ - стереть точку, СКМ - отменить изменения на слое редактора\n- При изменении размера битмапа, при перемещении и масштабировании изображения слой редактора очищается\n\nПРОЧЕЕ\n- Активный пиксель на выбранном стиле отображения: OLED - голубой, Paper - чёрный\n- При открытии приложения с локального сервера (IP адрес в строке адреса), например с esp, появится кнопка Send - при нажатии приложение отправит битмап в выбранном формате через formData на url /bitmap с query string параметрами width и height, т.е. <ip>/bitmap?width=N&height=N",e.className="info_inner",n.addEventListener("click",(()=>t.remove())),t.addEventListener("click",(()=>t.remove())),e.addEventListener("click",(t=>t.stopPropagation())),n.innerText="x",e.append(n,i),t.append(e),document.body.append(t)}document.addEventListener("DOMContentLoaded",(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js");let t=document.createElement("div");t.id="export",t.className="export";let n=document.createElement("div");n.className="cv_cont";let i=document.createElement("div");i.className="cv_inner";let s=document.createElement("canvas");s.className="canvas",i.append(s),n.append(i),document.body.append(t,n),_=new r(s,E,M,T,p.values[0].on,p.values[0].off);let a={Copy:B,".h":D,".bin":S};window.location.hostname.match(/^((25[0-5]|(2[0-4]|1[0-9]|[1-9]|)[0-9])(\.(?!$)|$)){4}$/)&&(a.Send=O),f=e().create(0,0,"Bitmaper").addFileChooser("Image File","","",x).addText("Image Link","",y).addText("Name","",k).addHTML(""," ").addNumber("Width",1,1e4,128,1,w).addNumber("Height",1,1e4,64,1,w).addButton("Fit",C).addRange("Rotate",-180,180,0,5,W).addDropDown("Process",h,k).addHTML("Result","").addTextArea("Code").addButtons(a).addButton("Info",P).setWidth(200).setDraggable(!1).setCollapsible(!1),f.setValue("Process",3),g=e().create(0,0,"Filter",t).addDropDown("Display Style",p.labels,H).addBoolean("Preview",1).addBoolean("Inverse",0,k).addRange("Gamma",.9,1.2,1,.005,k).addRange("Brightness",-128,128,0,1,k).addRange("Contrast",0,5,1,.1,k).addBoolean("Blur",0,k).addBoolean("Edges",0,k).addRange("Sobel Edges",0,1,0,.05,k).addBoolean("Dither",0,k).addRange("Threshold",0,100,50,1,k).addBoolean("Median Edges",0,k).addBoolean("Editor",0).addButton("Reset",L).setWidth(200).setDraggable(!1).setCollapsible(!1),w()}))})()})();