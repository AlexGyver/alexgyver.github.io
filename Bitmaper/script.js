(()=>{var t={947:(t,e,n)=>{"use strict";t.exports=function(t){const e=n(94),r=t?t.preset:"ru",i={а:"a",б:"b",в:"v",д:"d",з:"z",й:"y",к:"k",л:"l",м:"m",н:"n",о:"o",п:"p",р:"r",с:"s",т:"t",у:"u",ф:"f",ь:""};let a;"ru"===r?Object.assign(i,{г:"g",и:"i",ъ:"",ы:"i",э:"e"}):"uk"===r?Object.assign(i,{г:"h",ґ:"g",е:"e",и:"y",і:"i","'":"","’":"",ʼ:""}):"mn"===r&&Object.assign(i,{г:"g",ө:"o",ү:"u",и:"i",ы:"y",э:"e",ъ:""}),"ru"===r?a=Object.assign(e(i),{i:"и","":""}):("uk"===r||"mn"===r)&&(a=Object.assign(e(i),{"":""}));const s="ru"===r?{е:"ye"}:{є:"ye",ї:"yi"},o={ё:"yo",ж:"zh",х:"kh",ц:"ts",ч:"ch",ш:"sh",щ:"shch",ю:"yu",я:"ya"},l=Object.assign({},o,s),c=Object.assign(e(l)),h=Object.assign(i,l),d=Object.assign({},i,{й:"i"});let u;"ru"===r?Object.assign(d,{е:"e"}):"uk"===r?Object.assign(d,{ї:"i"}):"mn"===r&&Object.assign(d,{е:"e"}),"ru"===r?u=Object.assign(e(i),{i:"и",y:"ы",e:"е","":""}):"uk"===r&&(u=Object.assign(e(i),{"":""}));let f={};"uk"===r&&(f={є:"ie",ю:"iu",я:"ia"});const g=Object.assign(o,f),p=Object.assign(e(g)),m=Object.assign(d,g);return{transform:function(t,e){if(!t)return"";const n=t.normalize();let i="",a=!1;for(let t=0;t<n.length;t++){const s=n[t]===n[t].toUpperCase();let o,l=n[t].toLowerCase();" "!==l?("uk"===r&&"зг"===n.slice(t-1,t+1).toLowerCase()?o="gh":0===t||a?(o=h[l],a=!1):o=m[l],void 0===o?i+=s?l.toUpperCase():l:s?o.length>1?i+=o[0].toUpperCase()+o.slice(1):i+=o.toUpperCase():i+=o):(i+=e||" ",a=!0)}return i},reverse:function(t,e){if(!t)return"";const n=t.normalize();let r="",i=!1,s=0;for(;s<n.length;){const t=n[s]===n[s].toUpperCase();let o,l=n[s].toLowerCase(),h=s;if(" "===l||l===e){r+=" ",i=!0,s++;continue}let d=n.slice(s,s+2).toLowerCase();0===s||i?(o=c[d],o?s+=2:(o=a[l],s++),i=!1):(o=p[d],o?s+=2:(o=u[l],s++)),"shch"===n.slice(h,h+4).toLowerCase()?(o="щ",s=h+4):"zgh"===n.slice(h-1,h+2).toLowerCase()&&(o="г",s=h+2),void 0===o?r+=t?l.toUpperCase():l:t?o.length>1?r+=o[0].toUpperCase()+o.slice(1):r+=o.toUpperCase():r+=o}return r}}}},94:t=>{var e=9007199254740991,n="[object Arguments]",r="[object Function]",i="[object GeneratorFunction]",a=/^(?:0|[1-9]\d*)$/;var s,o,l=Object.prototype,c=l.hasOwnProperty,h=l.toString,d=l.propertyIsEnumerable,u=(s=Object.keys,o=Object,function(t){return s(o(t))});function f(t,e){var r=x(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&_(t)}(t)&&c.call(t,"callee")&&(!d.call(t,"callee")||h.call(t)==n)}(t)?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],i=r.length,a=!!i;for(var s in t)!e&&!c.call(t,s)||a&&("length"==s||b(s,i))||r.push(s);return r}var g,p=function(t,e,n){for(var r=-1,i=Object(t),a=n(t),s=a.length;s--;){var o=a[g?s:++r];if(!1===e(i[o],o,i))break}return t};function m(t,e,n,r){return function(t,e){t&&p(t,e,S)}(t,(function(t,i,a){e(r,n(t),i,a)})),r}function v(t){if(n=(e=t)&&e.constructor,r="function"==typeof n&&n.prototype||l,e!==r)return u(t);var e,n,r,i=[];for(var a in Object(t))c.call(t,a)&&"constructor"!=a&&i.push(a);return i}function b(t,n){return!!(n=null==n?e:n)&&("number"==typeof t||a.test(t))&&t>-1&&t%1==0&&t<n}var x=Array.isArray;function _(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=e}(t.length)&&!function(t){var e=function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}(t)?h.call(t):"";return e==r||e==i}(t)}var y,w,k,$=(y=function(t,e,n){t[e]=n},k=function(t){return t},w=function(){return k},function(t,e){return m(t,y,w(e),{})});function S(t){return _(t)?f(t):v(t)}t.exports=$}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var a=e[r]={exports:{}};return t[r](a,a.exports,n),a.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";class t{static addStyle(e,n,r=!1){if(e&&n&&("object"==typeof n&&(n=n.constructor.name),!t.#t.has(n)&&!t.#e.has(n))){if("object"==typeof e){let t="",n=0;for(const r of e)if(n=!n)t+=r;else{t+="{";for(const e of r)t+=e+";";t+="}"}e=t}if(r){let r=document.createElement("style");document.head.appendChild(r),r.sheet.insertRule(e),t.#e.set(n,r)}else t.#n||(t.#n=document.head.appendChild(document.createElement("style")).sheet),t.#n.insertRule(e),t.#t.add(n)}}static removeStyle(e){t.#e.has(e)&&(t.#e.get(e).remove(),t.#e.delete(e))}static#n;static#t=new Set;static#e=new Map}class e{constructor(t,n={},r=null,i=null,a=!1){n.context=this,this.$root=e.make(t,n,r,i,a)}static make(n,r={},i=null,a=null,s=!1){if(t.addStyle(i,a,s),!n||"object"!=typeof r)return null;if(r instanceof Node)return r;const o=r.context,l=document.createElement(n);for(const[t,n]of Object.entries(r))switch(t){case"tag":case"context":continue;case"text":l.textContent=n;break;case"html":l.innerHTML=n;break;case"class":l.className=n;break;case"also":o&&n.call(o,l);break;case"export":n[0]=l;break;case"var":o&&(o["$"+n]=l);break;case"events":for(let t in n)n[t]&&l.addEventListener(t,n[t].bind(o));break;case"parent":n instanceof Element&&n.append(l);break;case"attr":for(let t in n)l.setAttribute(t,n[t]);break;case"style":if("string"==typeof n)l.style=n+";";else for(let t in n)l.style[t]=n[t];break;case"children":for(const t of n)if(t instanceof Node)l.appendChild(t);else if(t instanceof e)l.appendChild(t.$root);else if("object"==typeof t){t.context||(t.context=o);let n=e.make(t.tag,t);n&&l.appendChild(n)}else"string"==typeof t&&(l.innerHTML+=t);break;default:l[t]=n}return l}static makeArray(t){return t.map((t=>e.make(t.tag,t)))}}class r{_data;constructor(t){this._data=t}get label(){return this._data.$label.innerText}set label(t){return this._data.$label.innerText=t}get value(){return this._data.$control.value}set value(t){return this._data.$control.value=t}get input(){return this._data.$control}display(t){this._data.$container.style.display=t?"block":"none"}show(){this.display(1)}hide(){this.display(0)}remove(){this._data.$container.remove()}default(){this.value=this._data.default,this._data.$output&&(this._data.$output.innerText=this._data.default)}}class i extends r{constructor(t){super(t)}set value(t){return this._data.$control.value=t}get value(){return Number(this._data.$control.value)}}class a extends r{constructor(t){super(t)}get value(){return this._data.$control.checked}set value(t){return this._data.$control.checked=t}}class s extends r{constructor(t){super(t)}get value(){return this._data.$control.innerHTML}set value(t){return this._data.$control.innerHTML=t}}class o extends r{constructor(t){super(t)}get value(){return this._data.$control.files[0]}set value(t){}}class l extends r{constructor(t){super(t)}set value(t){}get value(){return 1}}class c extends i{constructor(t){super(t)}set options(t){return this._data.$control.replaceChildren(...t.map(((t,n)=>e.make("option",{text:t,value:n}))))}}class h{constructor(t){return this.init(t)}init(t){return t&&"object"==typeof t?(e.make("div",{class:"ui_main theme-"+(t.theme??"light"),style:{zIndex:t.zIndex??3,left:t.x??0,top:t.y??0,width:(t.width??200)+"px"},parent:t.parent??document.body,children:[{tag:"div",class:"ui_title_bar",text:t.title??"UI"},{tag:"div",class:"ui_content",var:"content"}],var:"root",context:this}),this):this}setTheme(t){this.$root.classList="ui_main theme-"+t}destroy(){this.$root&&(this.$root.remove(),this.$root=void 0,this.#r=new Map)}setLabels(t){for(let e in t)this.#r.has(e)&&(this.#r.get(e).label=t[e])}toObject(){let t={};return this.#r.forEach(((e,n)=>{!e.value||e instanceof l||(t[n]=e.value)})),t}toJson(){return JSON.stringify(this.toObject())}fromObject(t){for(let e in t)this.#r.has(e)&&(this.#r.get(e).value=t[e])}fromJson(t){this.fromObject(JSON.parse(t))}control(t){return this.#r.get(t)}get(t){if(this.#r.has(t))return this.#r.get(t).value}set(t,e){if(this.#r.has(t))return this.#r.get(t).value=e}remove(t){this.#r.has(t)&&(this.#r.get(t).remove(),this.#r.delete(t))}addSwitch(t,n,r,i){let s={default:r};return e.make("div",{context:s,var:"container",class:"ui_container",parent:this.$content,children:[{tag:"label",class:"ui_checkbox_label",text:n,var:"label"},{tag:"label",class:"ui_checkbox",children:[{tag:"input",type:"checkbox",checked:r,var:"control",also(t){i&&t.addEventListener("click",(()=>i(t.checked)))}},{tag:"span"}]}]}),this.#r.set(t,new a(s)),this}addNumber(t,n,r,a,s){let o=this._makeContainerOut(n,r);return o.default=r,e.make("input",{parent:o.$container,context:o,type:"number",class:"ui_text_input ui_number",step:a,value:r,var:"control",also(t){t.addEventListener("input",(()=>{s&&s(Number(t.value)),o.$output.innerText=t.value}))}}),this.#r.set(t,new i(o)),this}addText(t,n,i,a){let s=this._makeContainer(n);return s.default=i,e.make("input",{parent:s.$container,context:s,type:"text",class:"ui_text_input",value:i,var:"control",also(t){a&&t.addEventListener("input",(()=>a(t.value)))}}),this.#r.set(t,new r(s)),this}addRange(t,n,r,a,s,o,l){let c=this._makeContainerOut(n,r);return c.default=r,e.make("input",{parent:c.$container,context:c,type:"range",class:"ui_range",value:r,min:a,max:s,step:o,var:"control",also(t){t.addEventListener("input",(()=>{l&&l(Number(t.value)),c.$output.innerText=t.value}))}}),this.#r.set(t,new i(c)),this}addArea(t,n,i,a){let s=this._makeContainer(n);return s.default=i,e.make("textarea",{parent:s.$container,context:s,class:"ui_textarea",rows:5,value:i,var:"control",also(t){a&&t.addEventListener("input",(()=>a(t.value)))}}),this.#r.set(t,new r(s)),this}addHTML(t,n,r){let i=this._makeContainer(n);return i.default=r,e.make("div",{parent:i.$container,context:i,html:r,var:"control"}),this.#r.set(t,new s(i)),this}addElement(t,e,n){let r=this._makeContainer(e);return r.default=n,r.$control=n,r.$container.append(n),this.#r.set(t,new s(r)),this}addSelect(t,n,r,i){let a=this._makeContainer(n);return a.default=0,e.make("select",{parent:a.$container,context:a,class:"ui_select",var:"control",also(t){i&&t.addEventListener("change",(()=>i(Number(t.value))))},children:r.map(((t,n)=>e.make("option",{text:t,value:n})))}),this.#r.set(t,new c(a)),this}addButton(t,n,r){let i={};return e.make("div",{context:i,var:"container",class:"ui_container",parent:this.$content,children:[this._makeButton(i,t,n,r)]}),i.$label=i.$control,this.#r.set(t,new l(i)),this}addButtons(t){let n=e.make("div",{var:"container",class:"ui_container",parent:this.$content});for(let e in t){let r={$container:n};n.append(this._makeButton(r,e,t[e][0],t[e][1])),r.$label=r.$control,this.#r.set(e,new l(r))}return this}addFile(t,n,r){let i=this._makeContainer(n);return i.$container.append(...e.makeArray([{tag:"input",context:i,class:"ui_file_chooser",type:"file",var:"control",also(t){t.addEventListener("change",(()=>{r&&r(t.files[0]),i.$filename.innerText=t.files[0].name}))}},{tag:"label",context:i,class:"ui_file_chooser_label",text:"...",var:"filename",also(t){t.addEventListener("click",(()=>i.$control.click()))}}])),this.#r.set(t,new o(i)),this}addColor(t,n,r,a){let s=this._makeContainerOut(n,r);return s.default=r,s.$container.append(e.make("input",{context:s,type:"color",class:"ui_color",value:r,var:"control",attr:{"colorpick-eyedropper-active":!1},also(t){t.addEventListener("input",(()=>{a&&a(t.value),s.$output.innerText=t.value}))}})),this.#r.set(t,new i(s)),this}_makeButton(t,n,r,i){return e.make("button",{context:t,class:"ui_button",var:"control",text:r,also(t){i&&t.addEventListener("click",(()=>i(1)))}})}_makeContainer(t){let n={};return e.make("div",{context:n,var:"container",class:"ui_container",parent:this.$content,children:[{tag:"div",class:"ui_label",children:[{tag:"b",var:"label",text:t}]}]}),n}_makeContainerOut(t,n){let r={};return e.make("div",{context:r,var:"container",class:"ui_container",parent:this.$content,children:[{tag:"div",class:"ui_label",children:[{tag:"b",text:t,var:"label"},{tag:"span",text:": "},{tag:"span",text:n,var:"output"}]}]}),r}#r=new Map}class d{matrix=new Int32Array;W=0;H=0;constructor(t,e){this.resize(t,e)}resize(t,e){t&&e&&(this.W=t,this.H=e,this.matrix=new Int32Array(t*e).fill(0))}merge(t){if(this.matrix.length==t.matrix.length)for(let e=0;e<this.matrix.length;e++){let n=t.matrix[e];n&&(this.matrix[e]=1==n?1:0)}}set(t,e,n){this.matrix[e*this.W+t]=n}get(t,e){return this.matrix[e*this.W+t]}clear(){this.matrix.fill(0)}}class u extends d{constructor(t,e,n,r,i="#478be6",a=0){super(),t&&(this.cv=t,this.cx=t.getContext("2d"),this.setColors(i,a),this._onclick=e,this._ondrag=n,this._onwheel=r,window.addEventListener("resize",(()=>this._resize())),t.addEventListener("mousedown",(t=>this._onMouseDown(t))),t.addEventListener("mousewheel",(t=>this._onMouseWheel(t))),t.addEventListener("contextmenu",(t=>t.preventDefault())),document.addEventListener("mousemove",(t=>this._onMouseMove(t))),document.addEventListener("mouseup",(t=>this._onMouseUp(t))))}setColors(t,e){this.active=t,this.back=e,this.cx.strokeStyle=e?"white":"black"}setMode(t){this.mode=t}resize(t,e){super.resize(t,e),this._resize()}render(t){this._grid=t,this.cx.fillStyle=this.back?"white":"black",this.cx.fillRect(0,0,this.cv.width,this.cv.height);let e=this._blocksize;this.cx.fillStyle=this.active;for(let n=0;n<this.W;n++)for(let r=0;r<this.H;r++){let i=this.get(n,r);if(i){switch(this.mode){case 0:break;case 1:this.cx.fillStyle=this.active+i.toString(16).padStart(2,0);break;case 2:this.cx.fillStyle="#"+i.toString(16).padStart(6,0)}this.cx.fillRect(n*e,r*e,e,e),t&&e>this._minsize&&this.cx.strokeRect(n*e,r*e,e,e)}}}grid(){let t=this._blocksize;if(!(t<this._minsize)){for(let e=0;e<this.W;e++)this.cx.beginPath(),this.cx.moveTo(e*t,0),this.cx.lineTo(e*t,this.cv.height),this.cx.stroke();for(let e=0;e<this.H;e++)this.cx.beginPath(),this.cx.moveTo(0,e*t),this.cx.lineTo(this.cv.width,e*t),this.cx.stroke()}}_blocksize=0;_scale=1;_pressed=!1;_dragged=!1;_pressXY=[];_minsize=3;_realW=0;_realH=0;_grid=1;_maxwidth=800;mode=0;_resize(){if(!this.cv)return;let t=this.cv.parentNode.clientWidth;t=Math.floor(t/this.W)*this.W,t||(t=this.W);let e=t*this.H/this.W;this._blocksize=t/this.W,this.cv.width=t,this.cv.height=e,this.cx.lineWidth=this._blocksize/64,t=this.cv.parentNode.clientWidth,e=t*this.H/this.W,e>this._maxwidth&&(e=this._maxwidth,t=e*this.W/this.H),this._realW=t,this._realH=e,this.cv.style.width=t+"px",this.cv.style.height=e+"px",this.render(this._grid)}_onMouseWheel(t){this._onwheel(t.deltaY<0?1:-1)}_onMouseDown(t){this._pressed=!0,this._dragged=!1,this._pressXY=this._getXY(t)}_onMouseMove(t){if(!this._pressed)return;this._dragged||(this.cv.style.cursor="grab",document.body.style.cursor="grab"),this._dragged=!0;let e=this._getXY(t);this._ondrag(this._drag(e,!1),{1:0,4:1,2:2}[t.buttons])}_onMouseUp(t){if(!this._pressed)return;this._pressed=!1;let e=this._getXY(t);this._dragged?(this.cv.style.cursor="pointer",document.body.style.cursor="default",this._ondrag(this._drag(e,!0),t.button)):this._onclick(this._blockXY(e),t.button),this._dragged=!1}_getXY(t){let e=t.pageX,n=t.pageY;return"BODY"===this.cv.offsetParent.tagName.toUpperCase()?(e-=this.cv.offsetLeft,n-=this.cv.offsetTop):(e-=this.cv.offsetParent.offsetLeft,n-=this.cv.offsetParent.offsetTop),e*=this.cv.width/this._realW,n*=this.cv.height/this._realH,{x:e,y:n}}_blockXY(t){return{x:Math.floor(t.x/this.cv.width*this.W),y:Math.floor(t.y/this.cv.height*this.H)}}_drag(t,e){return{dx:t.x-this._pressXY.x,dy:t.y-this._pressXY.y,block:this._blockXY(t),release:e}}}var f=n(947),g=n.n(f);function p(t,e,n){return t<e?e:t>n?n:t}function m(t){return t|0}function v(t){return[t>>16&255,t>>8&255,255&t]}const b={names:["1 pix/byte","8x Horizontal","8x Vertical","GyverGFX Image","GyverGFX BitMap","GyverGFX BitPack","Grayscale","RGB888","RGB565","RGB233"],prefix:["const uint8_t","const uint8_t","const uint8_t","gfximage_t","gfxmap_t","gfxpack_t","const uint8_t","const uint8_t","const uint16_t","const uint8_t"],extension:["1p","8h","8v","img","map","pack","gray","rgb888","rgb565","rgb233"],func:[function(t){return t.matrix.map((t=>t?1:0))},function(t){let e=[],n=Math.ceil(t.W/8);for(let r=0;r<t.H;r++)for(let i=0;i<n;i++){let n=0;for(let e=0;e<8;e++)n<<=1,n|=t.get(8*i+e,r);e.push(n)}return e},function(t){let e=[],n=Math.ceil(t.H/8);for(let r=0;r<t.W;r++)for(let i=0;i<n;i++){let n=0;for(let e=0;e<8;e++)n>>=1,n|=t.get(r,8*i+e)<<7;e.push(n)}return e},function(t){let e=Math.ceil(t.H/8)*t.W+4,n=x(t);return e<=n.length?[0].concat(_(t)):[1].concat(n)},_,x,function(t){return[...t.matrix]},function(t){let e=[];for(let n of t.matrix)e.push(...v(n));return e},function(t){let e=[];for(let n of t.matrix){let t=v(n);e.push((248&t[0])<<8|(252&t[1])<<3|t[0]>>3)}return e},function(t){let e=[];for(let n of t.matrix){let t=v(n);e.push(192&t[0]|(224&t[1])>>2|(224&t[2])>>5)}return e}],mult:[1,1,1,1,1,1,1,1,2,1]};function x(t){let e=[255&t.H,t.H>>8&255,0,0],n=0,r=0,i=0,a=()=>{let t=n<<1|r;switch(3&i++){case 0:e.push(t<<2);break;case 1:e[e.length-1]|=t>>4,e.push(t<<4&240);break;case 2:e[e.length-1]|=t>>2,e.push(t<<6&192);break;case 3:e[e.length-1]|=t}};for(let e=0;e<t.W;e++)for(let i=0;i<t.H;i++){let s=t.get(e,i);n?r==s?(n++,31==n&&(a(),n=0)):(a(),r=s,n=1):(n=1,r=s)}n&&a();let s=e.length-4;return e[2]=255&s,e[3]=s>>8&255,e}function _(t){return[255&t.W,t.W>>8&255,255&t.H,t.H>>8&255].concat(function(t){let e=[],n=Math.ceil(t.H/8);for(let r=0;r<n;r++)for(let n=0;n<t.W;n++){let i=0;for(let e=0;e<8;e++)i>>=1,i|=t.get(n,8*r+e)<<7;e.push(i)}return e}(t))}function y(t,e){let n=b.func[e](t),r=Int8Array.from(n);return new Blob([r],{type:"application/octet-stream"})}function w(t,e,n){let r=b.func[e](t),i=`${b.prefix[e]} ${n}_${t.W}x${t.H}[] PROGMEM = {`;return i+=function(t,e=16){let n="",r=0;for(let i of t)r||(n+="\n\t"),n+=`0x${i.toString(16).padStart(2,0)}, `,++r==e&&(r=0);return n}(r,24),i+="\n};",{code:i,size:r.length*b.mult[e]}}const k=[{base:{file:"Image file",link:"Image link",name:"Name",width:"Width",height:"Height",fit:"Fit",rotate:"Rotate",mode:"Mode",process:"Process",result:"Result",code:"Code",copy:"Copy",header:".h",bin:"bin",send:"Send",info:"Info"},filters:{display:"Display style",grid:"Grid",invert_b:"Invert background",preview:"Preview",invert:"Invert",brightness:"Brightness",contrast:"Contrast",saturate:"Saturate",blur:"Blur",edges:"Edges",sobel:"Sobel edges",dither:"Dithering",threshold:"Threshold",median:"Median edges",editor:"Editor",png:"Save .png",reset:"Reset"},display:["Screen","Paper"]},{base:{file:"Файл",link:"Ссылка",name:"Имя",width:"Ширина",height:"Высота",fit:"Центрировать",rotate:"Повернуть",mode:"Режим",process:"Процесс",result:"Результат",code:"Код",copy:"Копировать",header:".h",bin:"bin",send:"Отправить",info:"Инфо"},filters:{display:"Стиль отображения",grid:"Сетка",invert_b:"Инвертировать фон",preview:"Предпросмотр",invert:"Инвертировать",brightness:"Яркость",contrast:"Контраст",saturate:"Насыщенность",blur:"Размытие",edges:"Усилить края",sobel:"Выделить края",dither:"Dithering",threshold:"Порог",median:"Выделить край",editor:"Редактор",png:"Сохранить .png",reset:"Сброс"},display:["Дисплей","Бумага"]}];let $=new h,S=new h;let L=new u,M=new class{name="";image;first=!1;offset={x:0,y:0,dx:0,dy:0,w:0};async load(t){return new Promise(((e,n)=>{const r=new Image;switch(r.crossOrigin="Anonymous",r.addEventListener("load",(()=>{r.width&&r.height?(this.image=r,this.first=!0,e()):n("Image error")})),r.addEventListener("error",(()=>{n("Image load error")})),typeof t){case"object":t.type.toString().includes("image")||n("Not an image"),r.src=URL.createObjectURL(t),this.name=this._getName(t.name);break;case"string":t.startsWith("http")||n("Not a link"),r.src=t,this.name=this._getName(t);break;default:n("Image error")}}))}scale(t){this.image&&(this.offset.w+=t*this.offset.w/64)}pan(t,e,n){this.image&&(this.offset.dx=t,this.offset.dy=e,n&&(this.offset.x-=this.offset.dx,this.offset.dx=0,this.offset.y-=this.offset.dy,this.offset.dy=0))}show(t,e,n,r){this.image&&(this._render(t.cv,e,n,r),t.grid())}fit(t){this.offset={x:0,y:0,dx:0,dy:0,w:0};let e=t.cv.width,n=e*this.image.height/this.image.width;n>t.cv.height&&(e*=t.cv.height/n,n=t.cv.height),this.offset.w=e/t.cv.width}render(t,e,n,r){if(!this.image)return;this.first&&(this.first=!1,this.fit(t));let i=document.createElement("canvas");i.width=t.cv.width,i.height=t.cv.height;let a=i.getContext("2d");a.fillStyle=n?"white":"black",a.fillRect(0,0,i.width,i.height),this._render(i,e,n,r);let s=document.createElement("canvas");s.width=t.W,s.height=t.H;let o=s.getContext("2d");o.drawImage(i,0,0,s.width,s.height),t.clear();let l=o.getImageData(0,0,t.W,t.H).data;for(let e=0,n=0;e<l.length;e+=4,n++)l[e+3]&&(t.matrix[n]=(c=l[e],h=l[e+1],d=l[e+2],c<<16|h<<8|d));var c,h,d}_render(t,e,n,r){let i=document.createElement("canvas"),a=t.width*this.offset.w,s=a*this.image.height/this.image.width,o=Math.sqrt(a**2+s**2);i.width=o,i.height=o;let l=i.getContext("2d");l.save(),l.translate(o/2,o/2),l.rotate(.0174533*-e),l.filter=`invert(${r.invert??0}) brightness(${r.brightness??0}%) contrast(${r.contrast??0}%) saturate(${r.saturate??0}%) grayscale(${r.grayscale??0}%) blur(${(r.blur??0)*o/64}px)`,l.drawImage(this.image,-a/2,-s/2,a,s),l.restore();let c=t.getContext("2d");c.fillStyle=n?"white":"black",c.fillRect(0,0,t.width,t.height),c.drawImage(i,this.offset.x-this.offset.dx+(o-t.width)/2,this.offset.y-this.offset.dy+(o-t.height)/2,t.width,t.height,0,0,t.width,t.height)}_getName(t){return(t=(t=(new(g())).transform(t,"_")).substring(t.lastIndexOf("/")+1,t.lastIndexOf(".")).replaceAll("-","_").substring(0,10)).length?t[0]>="0"&&t[0]<="9"&&(t="b"+t):t="bitmap",t}},B=new d,C=new class{#i;start(t,e){this.stop(),this.#i=setTimeout(t,e)}stop(){this.#i&&(clearTimeout(this.#i),this.#i=null)}};const O=[{active:"#478be6",back:0},{active:"#000000",back:1}];async function E(t){try{await M.load(t)}catch(t){return void alert(t)}B.clear(),$.set("name",M.name),H()}async function j(t){t.length&&(await E(t),$.set("link",""))}function W(){let t=[$.get("width"),$.get("height")];L.resize(t[0],t[1]),B.resize(t[0],t[1]),Math.max(t[0],t[1])>500&&S.set("preview",!1),H()}function R(){M.image&&M.fit(L),H()}function H(){if(M.image){let t=$.get("mode");if(M.render(L,$.get("rotate"),S.get("invert_b"),{invert:O[S.get("display")].back^S.get("invert"),brightness:S.get("brightness"),contrast:S.get("contrast"),saturate:S.get("saturate"),blur:S.get("blur"),grayscale:2==t?0:100}),2!=t)for(let t=0;t<L.matrix.length;t++)L.matrix[t]&=255;t<=1&&(S.get("edges")&&function(t,e,n){const r=[[-1,-1,-1],[-1,9,-1],[-1,-1,-1]];let i=[...t];for(let a=1;a<e-1;a++)for(let s=1;s<n-1;s++){let n=0;for(let t=-1;t<=1;t++)for(let o=-1;o<=1;o++){let l=i[a+t+(s+o)*e];n+=r[o+1][t+1]*l}t[a+s*e]=m(p(n,0,255))}}(L.matrix,L.W,L.H),S.get("sobel")&&function(t,e,n,r){const i=[[-1,0,1],[-2,0,2],[-1,0,1]],a=[[-1,-2,-1],[0,0,0],[1,2,1]];let s=[...t];for(let r=0;r<e;r++)for(let o=0;o<n;o++){let l=0,c=0;if(0!=r&&r!=e-1&&0!=o&&o!=n-1)for(let n=-1;n<=1;n++)for(let s=-1;s<=1;s++){let h=t[r+n+(o+s)*e];l+=i[s+1][n+1]*h,c+=a[s+1][n+1]*h}let h=Math.sqrt(l**2+c**2);s[r+o*e]=p(h,0,255)}for(let e=0;e<t.length;e++){let n=t[e]*(1-r)+s[e]*r;t[e]=m(n)}}(L.matrix,L.W,L.H,S.get("sobel")),S.get("dither")&&function(t,e,n){for(let r=0;r<n;r++)for(let i=0;i<e;i++){let a=r*e+i,s=t[a]<128?0:255,o=t[a]-s;t[a]=s,i+1<e&&(t[a+1]+=7*o>>4),r+1!=n&&(i>0&&(t[a+e-1]+=3*o>>4),t[a+e]+=5*o>>4,i+1<e&&(t[a+e+1]+=1*o>>4))}}(L.matrix,L.W,L.H),0==t&&function(t,e){for(let n=0;n<t.length;n++)t[n]=t[n]<e?0:255}(L.matrix,2.56*S.get("threshold")),S.get("median")&&function(t,e,n){let r=[[0,0],[0,1],[1,0]],i=[...t];for(let a=0;a<e;a++)for(let s=0;s<n;s++)if(0!=a&&a!=e-1&&0!=s&&s!=n-1){let n=[];for(let t=0;t<r.length;t++)n.push(i[a+r[t][0]+(s+r[t][1])*e]);n.sort();let o=n[n.length-1]-n[0];t[a+s*e]=m(p(o,0,255))}}(L.matrix,L.W,L.H))}!function(){L.merge(B),L.render(S.get("grid"));let t=w(L,$.get("process"),$.get("name"));$.set("code",t.code);let e=`${L.W}x${L.H} (${t.size} bytes)<br>`;e+=Math.round(L.matrix.filter((t=>t)).length/L.matrix.length*100)+"% pixels on",$.set("result",e)}()}function T(){M.show(L,$.get("rotate"),O[S.get("display")].back^S.get("invert_b"),{invert:S.get("invert")})}function z(){let t=O[S.get("display")];L.setColors(t.active,t.back),H()}function G(t){S.control("edges").display(2!=t),S.control("sobel").display(2!=t),S.control("median").display(2!=t),S.control("dither").display(0==t),S.control("threshold").display(0==t),S.control("editor").display(0==t),$.set("process",0==t?0:1==t?6:7),L.setMode(t),H()}function I(){$.control("rotate").default(),S.control("invert_b").default(),S.control("invert").default(),S.control("brightness").default(),S.control("contrast").default(),S.control("saturate").default(),S.control("blur").default(),S.control("edges").default(),S.control("sobel").default(),S.control("dither").default(),S.control("threshold").default(),S.control("median").default(),S.control("editor").default(),B.clear(),H()}function N(t){return 0==t?1:1==t?0:-1}function P(t,e){S.get("editor")&&(B.set(t.x,t.y,N(e)),H())}function U(t,e){if(S.get("editor"))return B.set(t.block.x,t.block.y,N(e)),void H();B.clear(),M.pan(t.dx,t.dy,t.release),S.get("preview")||t.release?H():T()}function X(t){S.get("editor")||(C.stop(),B.clear(),M.scale(t),S.get("preview")?H():(T(),C.start(H,400)))}function A(){B.clear(),S.get("preview")?H():(T(),C.start(H,400))}function D(){navigator.clipboard.writeText($.get("code"))}function F(){!function(t,e,n){let r=w(t,e,n),i=`#pragma once\n#include <Arduino.h>\n${e>=3&&e<=5?"#include <GyverGFX.h>":""}\n\n// ${n} (${r.size} bytes)\n// ${b.names[e]}\n\n`;i+=r.code;let a=(new TextEncoder).encode(i),s=new Blob([a],{type:"text/plain"}),o=document.createElement("a");o.href=window.URL.createObjectURL(s),o.download=n+".h",o.click()}(L,$.get("process"),$.get("name"))}function Y(){!function(t,e,n){let r=y(t,e),i=document.createElement("a");i.href=window.URL.createObjectURL(r),n+="."+b.extension[e],i.download=n,i.click()}(L,$.get("process"),$.get("name"))}function J(){let t=y(L,$.get("process")),e=new FormData;e.append("bitmap",t),fetch(window.location.href+`bitmap?width=${L.W}&height=${L.H}`,{method:"POST",body:e})}function q(){let t=document.createElement("a");t.href=L.cv.toDataURL("image/png"),t.download=$.get("name")+".png",t.click()}function V(t){$.set("lang",t),$.setLabels(k[t].base),S.setLabels(k[t].filters),S.control("display").options=k[t].display}function K(){let t={};e.make("div",{class:"info_cont",var:"info",parent:document.body,context:t,also(t){t.addEventListener("click",(()=>t.remove()))},children:[{tag:"div",class:"info_inner",also(t){t.addEventListener("click",(t=>t.stopPropagation()))},children:[{tag:"button",text:"x",also(e){e.addEventListener("click",(()=>t.$info.remove()))}},{tag:"span",text:"Bitmaper - программа для преобразования картинок в битмапы\n\nPROCESS\n- 1x pix/byte - 1 пиксель в байте, строками слева направо сверху вниз [data_0, ...data_n]\n- 8x Horizontal - 8 пикселей в байте горизонтально (MSB слева), строками слева направо сверху вниз [data_0, ...data_n]\n- 8x Vertical - 8 пикселей в байте вертикально (MSB снизу), столбцами сверху вниз слева направо  [data_0, ...data_n]\n- GyverGFX BitMap - 8 пикселей вертикально (MSB снизу), строками слева направо сверху вниз: [widthLSB, widthMSB, heightLSB, heightMSB, data_0, ...data_n]\n- GyverGFX BitPack - сжатый формат*: [heightLSB, heightMSB, lenLSB, lenMSB, data_0, ...data_n]\n- GyverGFX Image - программа выберет лёгкий между BitMap и BitPack: [0 map | 1 pack, x, x, x, x, data_0, ...data_n]\n- Grayscale - 1 пиксель в байте, оттенки серого\n- RGB888 - 1 пиксель на 3 байта (24 бит RGB) [r0, g0, b0, ...]\n- RGB565 - 1 пиксель на 2 байта (16 бит RGB) [rrrrrggggggbbbbb] тип uint16\n- RGB233 - 1 пиксель в байте (8 бит RGB) [rrgggbbb]\n* На изображениях со сплошными участками BitPack может быть в разы эффективнее обычного BitMap. На изображениях с dithering работает неэффективно.\n\nФИЛЬТРЫ\n- Invert Background - инвертировать фон\n- Invert - инвертировать изображение\n- Brightness - яркость\n- Contrast - контраст\n- Saturate - насыщенность\n- Blur - размытие\n- Edges - усиление краёв\n- Sobel Edges - выделение краёв с настройкой интенсивности\n- Dither - псевдо оттенки серого через шум\n- Threshold - порог разделения оттенков серого на белый и чёрный. Не имеет смысла при включённом Dither\n- Median Edges - выделение краёв в толщину 1px. Работает на ч/б изображении, поэтому зависит от Threshold\n\nРЕДАКТОР (Editor)\n- Действия кнопок мыши при включенном редакторе: ЛКМ - добавить точку, ПКМ - стереть точку, СКМ - отменить изменения на слое редактора\n- При изменении размера битмапа, при перемещении и масштабировании изображения слой редактора очищается\n\nПРОЧЕЕ\n- Активный пиксель на выбранном стиле отображения: OLED - голубой, Paper - чёрный\n- При открытии приложения с локального сервера (IP адрес в строке адреса), например с esp, появится кнопка Send - при нажатии приложение отправит битмап в выбранном формате через formData на url /bitmap с query string параметрами width и height, т.е. <ip>/bitmap?width=N&height=N"}]}]})}document.addEventListener("DOMContentLoaded",(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js");let t=e.make("div",{id:"filters",class:"filters",parent:document.body}),n={};e.make("div",{class:"cv_cont",context:n,parent:document.body,children:[{tag:"div",class:"cv_inner",children:[{tag:"canvas",class:"canvas",var:"cv"}]}]}),L=new u(n.$cv,P,U,X,O[0].active,O[0].back);let r={copy:["Copy",D],header:[".h",F],bin:[".bin",Y]};switch(window.location.hostname.match(/^((25[0-5]|(2[0-4]|1[0-9]|[1-9]|)[0-9])(\.(?!$)|$)){4}$/)&&(r.send=["Send",J]),$=new h({title:"Bitmaper",theme:"dark"}).addFile("file","",E).addText("link","","",j).addText("name","","",H).addNumber("width","",128,1,W).addNumber("height","",64,1,W).addButton("fit","",R).addRange("rotate","",0,-180,180,5,A).addSelect("mode","",["Mono","Grayscale","RGB"],G).addSelect("process","",b.names,H).addHTML("result","","").addArea("code","","").addButtons(r).addSelect("lang","Language",["English","Russian"],V).addButton("info","",K),S=new h({title:"Filters",theme:"dark",parent:t}).addSelect("display","",[],z).addSwitch("grid","",1,H).addSwitch("invert_b","",0,H).addSwitch("preview","",1).addSwitch("invert","",0,H).addRange("brightness","",100,0,250,5,H).addRange("contrast","",100,0,250,5,H).addRange("saturate","",100,0,250,5,H).addRange("blur","",0,0,1,.05,H).addSwitch("edges","",0,H).addRange("sobel","",0,0,1,.05,H).addSwitch("dither","",0,H).addRange("threshold","11",50,0,100,1,H).addSwitch("median","",0,H).addSwitch("editor","",0).addButton("png","",q).addButton("reset","",I),navigator.language||navigator.userLanguage){case"ru-RU":case"ru":V(1);break;default:V(0)}W()}))})()})();