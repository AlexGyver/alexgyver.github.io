<!DOCTYPE HTML>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <style>
        .cont {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    </style>

    <div class="cont">
        <label id="list"></label>
        <h1>Knitter</h1>
        <canvas onclick="next()" id="canvas" width="800" height="800"></canvas>
    </div>

    <script>

        let s = document.location.toString();
        s = s.slice(s.indexOf('?') + 1);
        let lines = atob(s).split('').map(function (v) { return v.codePointAt(0) });
        let amount = lines.pop() * 256 + lines.pop();
        let start = false;

        var cur = 0;
        var cv = document.getElementById("canvas");
        var cx = cv.getContext("2d");
        cx.textAlign = "center";
        cx.textBaseline = "middle";

        let W2 = cv.width / 2;
        let R = W2 - 30;

        drawDots();

        cx.lineWidth = 1;
        cx.strokeStyle = "#0005";
        for (let i = 1; i < lines.length; i++) drawLine(i);
        cx.strokeStyle = "#000";

        cx.font = "80px Arial";
        cx.beginPath();
        cx.fillStyle = "#fff";
        cx.fillText("START", W2, W2);

        function drawNums() {
            cx.font = "12px Arial";
            cx.beginPath();
            cx.fillStyle = "#000";
            for (let i = 0; i < amount; i++) {
                let xy = getXYraw(i, R + 10);
                cx.fillText(i, xy.x, xy.y);
            }
        }

        function drawLine(node) {
            cx.lineWidth = 1;
            cx.strokeStyle = "#000";
            let xy0 = getXY(node - 1);
            let xy1 = getXY(node);
            cx.beginPath();
            cx.moveTo(xy0.x, xy0.y);
            cx.lineTo(xy1.x, xy1.y);
            cx.stroke();
        }
        function drawDots() {
            cx.fillStyle = "#000";
            for (let i = 0; i < amount; i++) {
                let xy = getXYraw(i, R);
                cx.beginPath();
                cx.arc(xy.x, xy.y, 2, 0, 2 * Math.PI);
                cx.fill();
            }
        }
        function getXY(node, r = R) {
            let x = W2 + r * Math.cos(2 * Math.PI * lines[node] / amount);
            let y = W2 + r * Math.sin(2 * Math.PI * lines[node] / amount);
            return { x, y };
        }
        function getXYraw(i, r) {
            let x = W2 + r * Math.cos(2 * Math.PI * i / amount);
            let y = W2 + r * Math.sin(2 * Math.PI * i / amount);
            return { x, y };
        }
        function test() {
            for (let i = 1; i < lines.length; i++) drawLine(i);
        }
        function arrow(node, state) {
            if (cur < 0) return;
            cx.beginPath();
            cx.lineWidth = state ? 5 : 7;
            cx.strokeStyle = state ? "#000" : "#FFF";
            let xy0 = getXY(node, R + 10 + (state ? 0 : -2));
            let xy1 = getXY(node, R + 30 + (state ? 0 : 2));
            cx.moveTo(xy0.x, xy0.y);
            cx.lineTo(xy1.x, xy1.y);
            cx.stroke();
        }
        function next() {
            if (!start) {
                cx.clearRect(0, 0, cv.width, cv.height);
                //drawNums();
                drawDots();
                start = true;
            }
            arrow(cur - 1, false);
            arrow(cur, true);
            

            cx.beginPath();
            cx.arc(W2, W2, R-2, 0, 2 * Math.PI);
            cx.fillStyle = "#ffffffaa";
            cx.fill();

            cx.beginPath();
            cx.rect(W2-80, W2-60, 160, 100);
            cx.fillStyle = "#ffffff";
            cx.fill();

            cx.font = "80px Arial";
            cx.beginPath();
            cx.fillStyle = "#000";
            cx.fillText(lines[cur], W2, W2);

            drawLine(cur, R-2);
            cur++;
        }
    </script>

</body>

</html>
