<html>

<body>
  <p>Disable: chrome://flags/#enable-webrtc-hide-local-ips-with-mdns</p>
  <p>Disable: chrome://flags/#block-insecure-private-network-requests</p>
  <input type="text" id="ip" value="unset">
  <br>
  <input type="number" id="port" value="50000">
  <br>
  <button onclick="scan()">Scan</button>
  <br>
  <label id="result" style="font-size: 20px;"></label>

  <script>
    getLocalIP().then((ip) => {
      document.getElementById("ip").value = (ip.indexOf("local") > 0) ? "disable anon" : ip;
    });

    function scan() {
      let key = "MyDevices";

      document.getElementById("result").innerHTML = "";
      let ip = document.getElementById("ip").value;
      let port = document.getElementById("port").value;
      let ip_a = ip.split('.');
      ip = ip_a[0] + '.' + ip_a[1] + '.' + ip_a[2] + '.';

      for (let i = 1; i < 255; i++) {
        let xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            document.getElementById("result").innerHTML += this.responseText + "\n";
          }
        }
        xhr.timeout = 2000;
        xhr.open("GET", "http://" + ip + i + ":" + port + "/" + key);
        xhr.send();
      }
    }

    function getLocalIP() {
      return new Promise(function (resolve, reject) {
        var RTCPeerConnection = /*window.RTCPeerConnection ||*/ window.webkitRTCPeerConnection || window.mozRTCPeerConnection;

        if (!RTCPeerConnection) {
          reject('Your browser does not support this API');
        }

        var rtc = new RTCPeerConnection({ iceServers: [] });
        var addrs = {};
        addrs["0.0.0.0"] = false;

        function grepSDP(sdp) {
          var hosts = [];
          var finalIP = '';
          sdp.split('\r\n').forEach(function (line) { // c.f. http://tools.ietf.org/html/rfc4566#page-39
            if (~line.indexOf("a=candidate")) {     // http://tools.ietf.org/html/rfc4566#section-5.13
              var parts = line.split(' '),        // http://tools.ietf.org/html/rfc5245#section-15.1
                addr = parts[4],
                type = parts[7];
              if (type === 'host') {
                finalIP = addr;
              }
            } else if (~line.indexOf("c=")) {       // http://tools.ietf.org/html/rfc4566#section-5.7
              var parts = line.split(' '),
                addr = parts[2];
              finalIP = addr;
            }
          });
          return finalIP;
        }

        if (1 || window.mozRTCPeerConnection) {      // FF [and now Chrome!] needs a channel/stream to proceed
          rtc.createDataChannel('', { reliable: false });
        };

        rtc.onicecandidate = function (evt) {
          // convert the candidate to SDP so we can run it through our general parser
          // see https://twitter.com/lancestout/status/525796175425720320 for details
          if (evt.candidate) {
            var addr = grepSDP("a=" + evt.candidate.candidate);
            resolve(addr);
          }
        };
        rtc.createOffer(function (offerDesc) {
          rtc.setLocalDescription(offerDesc);
        }, function (e) { console.warn("offer failed", e); });
      });
    }

  </script>
</body>

</html>